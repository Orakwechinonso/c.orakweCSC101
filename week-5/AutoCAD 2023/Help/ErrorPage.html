<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>	
    <title>ErroPage</title>
    <style type="text/css">
        A
        {
            outline: none;
        }
        
        html, body
        {
            margin: 0;
            padding: 0;
            height: 100%;
            background-color: #EEEEEE;
			font-family: Arial, Helvetica, sans-serif;
        }
        
        html[main-frame][high-color-depth] body
        {
            margin: 0;
            padding: 0;
            height: 100%;
            background: -webkit-linear-gradient(#FFF, #EEE);
            background-attachment: fixed;
        }
        
        #container
        {
            position: fixed;
            top: 0px;
            left: 0px;
            right: 0px;
            bottom: 25px; 
            overflow: auto;             
        }
        
        #adsk-logo
        {
            display: block;
            width: 132px;
            height: 24px;
            background: no-repeat top left url(data:image/gif;base64,R0lGODlhhAAYAMQQAICAgBAQEM/Pz5+fnyAgIN/f3+/v72BgYDAwMI+Pj6+vr3BwcFBQUEBAQL+/v////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABAALAAAAACEABgAAAX/ICSOZGmeaKqu6OG8L8LOpQs7tIo0jZz/QJbjQSQ2gixAkYgsFYqEpiogRSUEy2P1dMAWt43lYksiLAQ4silsVJ/Yj+1gWXBDho+0XQTX7vlfUgEGSw9+W3h6e31/I3BVB0QGhA8DbomNEIyZjysBVCd4A3MPBqAjDACqAAeOq6ojqk8PBauHAQsOAgYOA4clDQpYDgmRbSUIA0MCCq1rygZoCT6ATCMBr1EACg4MJgRFDAxFziOFeniBEIVLACMIs+enIgEK7FklCfcC8/r3Y9XijLBX5EgCBQsSmFBSSgQlASXOjUhnbd29B+4gIKC0bx7Bi4ZIkJK0RM+4IvEw/zpSx7AghAEAYJqYZeklFGSkFCVTx8OLAB4NokDw8mABFQREFYowVurApwPx/DBVECXASC14BAgFpzKgiJMPfoLCZhRYER8IiiglwVARhJYlMJEAm5FePKFED22CMKvAPJoiyJEgUvfRRiJ+Z5CqM2KWgYVE3MIlIXfESKEjmI7hGtbssbSE8xGByHc05jVFAngxQG2KWhL+HnhjG7nE5Im1KSP+VsQSnLoBtTAFKXDkAwWzPR8PR4Ppac4KbOeOpU5E5cDTB9dmmjy4iJbERRDgiLhcwCJuVRAlfrqt9IrWs1vMcwI9hAUuSWxqiebGjREEUDTaKXB8BNAKnBFXFP9t9DEoEG4NjuAFYyQEUER0vymnBX5EdKcCAQmkpAccg5zFQmwKUvjWbg7GJd9Hp0EA1hhw1LTSMXCs1RxHQj0CBz8rzEKaCR/5cZtGHLnYGQlMAXfHTRBQYgoJHIbkkCTzmDBEdKjk10lsNp4AlnlM9kYdETUtQF4JI8mwgwjxHDiSjSNpBQE2+HxXhJ3ixYSbilWC0olqzH3jQDwFOBCjMCW5AxZxDjhTpX0y0uEAR1OKR95FBihE6J6HQpnVC0Th0MUS71iqXJ7msJPGeoih2FWJhQg1HB2tQXBrZBLdCesSzghYhAHaFEKlsSQg4F8McS2rlFXDDhCAsjD48s4tRwZIC+AAHAkAQJYiIPBRLS9Va54LdCSAGQEArFcLKDbAwOZ/mdRrLwu5VhECADs=);
            text-decoration: none;
            margin-left: 40px;
            position: absolute;
            top: 28px;
        }        
        
        #header
        {
            background: #FFFFFF;
        }
        
        .header_bg
        {
            background-color: #000000;
            height: 80px;
        }
        .grey_header
        {
            background-color: #3f3f3f;
            height: 31px;
        }
        
        #boxWrapper
        {
            padding: 30px 0 30px;
        }
        
        #box
        {
            background-color: #FFFFFD;
            font-size: 10pt;
            line-height: 18px;
            margin: auto;
            max-width: 800px;
            min-width: 80px;
            max-height: 800px;
            min-height: 80px;
			padding: 5px;
        }        

		#box 
		{
		  border-radius: 6px;
		  -webkit-box-shadow: 2px 5px 12px #666;
		  padding: 20px;
		  width: 75%;
		}


        h1
        {
            font-size: 18pt;
            line-height: 30px;
			font-weight: bold;
            margin: 0;
        }
                
        h2
        {
            font-size: 13pt;
            font-weight: bold;
            margin: 0;
            padding: 0;
        }       
		
		#errorSummary, #errorSuggestions
		{
			-webkit-margin-start: 3px;
			margin-top: 15px;
		    font-size: 11pt;
		}
		
		#errorOfflineTitle
		{
			-webkit-margin-start: 3px;
			margin-top: 15px;
		}
		
		#errorSuggestions
        {
            -webkit-margin-start: 3px;
            margin-top: 15px;
			font-size: 11pt;
        }
		
		 #errorDetails
        {
            color: #777;
            -webkit-margin-start: 3px;
            margin-top: 30px;
        }
		
        
        .reload_btn
        {
            vertical-align: bottom;
            display: none;
        }
        
        .uiButton
        {
            background-repeat: no-repeat;
            background-size: auto;
            background-color: #118888;
            cursor: pointer;
            display: inline-block;
            font-size: 11px;
            font-weight: bold;
            line-height: 13px;
            padding: 3px 6px;
            text-align: center;
            text-decoration: none;
            white-space: nowrap;
            border: 1px solid #999;
            -webkit-box-shadow: 0px 2px 0px rgba(0, 0, 0, .1);
            border: 1px solid #999;
			margin-top : 6px;
            float: right;
        }
        
        #uiButtonReload
        {
            background: none;
            border: 0;
            cursor: pointer;
            display: inline-block;            
            font-size: 13px;
            padding: 3px 25px 5px;
            font-weight: bold;
            line-height: 13px;
            margin: 0;
            color: white;
            white-space: nowrap;
            text-decoration:none;
        }
        
        #footer
        {           
            color: #666;
            background-color: #b0b0b0;
            position: absolute; 
            bottom: 0; 
            left: 0;
            height: 25px;
            min-width: 80px;
            overflow: hidden;
            width: 100%;
        }
		
		#footer_text
		{			
			font-family: Arial, Helvetica, sans-serif;
            font-size: 8pt;
			text-align: left;
            text-decoration: none;
			vertical-align: bottom;
			
		}
    </style>	
    <script type="text/javascript" src="Autodesk.AutoCAD.Help.js"></script>
    <script type="text/javascript">
        function urlArgs(query) {
            var args = {};
            if (query) {
                var pairs = query.split("&");
                for (var i = 0; i < pairs.length; i++) {
                    var pos = pairs[i].indexOf("=");
                    if (pos != -1) {
                        var name = pairs[i].substr(0, pos);
                        var value = pairs[i].substr(pos + 1);
                        args[name] = decodeURIComponent(value);
                    }
                }
            }
            return args;
        }

        function offlineInstalled(callback) {
            help.Api.OfflineInstalled((jsonStr) => {
                jsonStr = jsonStr.replace("'", "\'");
                callback(JSON.parse(jsonStr).retValue)
            });
        }

        function getHomeUrl(bOnline, callback) {
            help.Api.HomeUrl(bOnline, (jsonStr) => {
                jsonStr = jsonStr.replace("'", "\'");
                callback(JSON.parse(jsonStr).retValue)
            });
        }

        function getContextId(url) {
            var pos = url.lastIndexOf("?");
            var contextId;
            if (pos != -1) {
                //http://docs.autodesk.com/ACD/2013/ENU/index.html?contextId=contextname
                var args = urlArgs(url.substring(pos + 1));
                if (args.contextId)
                    contextId = args.contextId;
            }
            else {
                //http://docs.autodesk.com/ACD/2013/ENU/contexthelp/TEST.htm
                pos = url.lastIndexOf("/");
                if (pos != -1) {
                    var pos1 = url.indexOf(".htm", pos + 1);
                    if (pos1 != -1)
                        contextId = url.substring(pos + 1, pos1)
                }
            }
            return contextId;
        }

        function getQureyUrl(url) {
            if (url) {
                var contextId = getContextId(url);
                if (contextId) {
                    var homeurl = getHomeUrl(url.indexOf("http://") == 0);
                    if (homeurl)
                        return homeurl + "?query=" + contextId;
                }
            }
            return "";
        }

        function getOfflinePage(url, callback) {
            if (url && url.indexOf("http://") == 0) {
                getHomeUrl(false, (offlieHomeUrl) => {
                    if (offlieHomeUrl) {
                        getHomeUrl(true, (homeUrl) => {
                            if (homeUrl === url)
                                callback(offlieHomeUrl)
                            else {
                                var contextId = getContextId(url);
                                if(contextId) 
                                    callback(offlieHomeUrl + "?contextId=" + contextId);
                            }
                        });
                    }
                });
            }
            else
                callback("");
        }


        function getErrorType(errorcode) {
            // this array's order should be same as title array
            var errors = [
                [-7, -105, -106], // these are from CEF, -7 means time out, -105 host name could not be resolved -106 means no connection
                [], // http error codes or CEF error code
                [404, -6]   // forward to search page
            ];
            for (var i = 0; i < errors.length; i++) {
                for (var j = 0; j < errors[i].length; j++) {
                    if (errors[i][j] == errorcode)
                        return i;
                }
            }
            return 1;//for other http or CEF error code
        }

        function switchPage() {
            var errorcode, errorType = 3; // see getErrorType for the type
            var args = urlArgs(location.search.substring(1))
            if (args.error) {
                errorcode = parseInt(args.error);
                errorType = getErrorType(errorcode);
            }
            if (errorType == 0) {
                //try to load offline help instead if possible
                var offlinePage = getOfflinePage(args.url);
                if (offlinePage) {
                    window.location.replace(offlinePage);
                    return;
                }
            }
            if (errorType == 2) {
                //try to forward to the search page if possible
                var queryPage = getQureyUrl(args.url);
                if (queryPage) {
                    window.location.replace(queryPage);
                    return;
                }
            }
        }
        switchPage();

        function loadStringAndInit(args, callback) {
            var local = args.local ? args.local : "en-US";
            var path = "local/" + local + "/strings.js";
            var script = document.createElement("script");
            script.type = "text/javascript";
            script.onload = function () { callback(args) };
            script.src = path;
            document.getElementsByTagName("head")[0].appendChild(script);
        }

        function Init(args) {
            var errorcode, errorType = 3; // see getErrorType for the type
            if (args.error) {
                errorcode = parseInt(args.error);
                errorType = getErrorType(errorcode);
            }
            if (errorType == 2) //treat it as generic error if cannot foreword
                errorType = 1;
            // The border only uses a gradient when using at least 24-bit color.
            if (window.screen.colorDepth >= 24)
                document.documentElement.setAttribute('high-color-depth', '');
            document.getElementById("title").innerText = titleMsg[errorType];
            document.getElementById("summary").innerText = summaryMsg[errorType];
            if (errorType == 0) {
                offlineInstalled((isOfflineInstalled) => {
                    if (!isOfflineInstalled()) {
                        document.getElementById("suggestions").innerText = suggestionMsg;
                        document.getElementById("offlinetitle").innerText = offlineMsg;
                    }
                });
            }
            else if (errorType == 1) {
                var msg = detailMsg[errorType] + errorcode;
                if (args.errorMsg)
                    msg += ":" + args.errorMsg;
                document.getElementById("details").innerText = msg;
                document.getElementById("btnDiv").style.display = "block";
                var ele = document.getElementById("uiButtonReload");
                ele.innerText = btnMsg;
                if (args.url)
                    ele.href = args.url;
            }
        }

        function onLoad() {
            loadStringAndInit(urlArgs(location.search.substring(1)), Init);
        }
    </script>
</head>
<body onload="onLoad();">
    <div id="container">
        <div id="header">
            <div class="header_bg">
                <div id="adsk-logo">
                </div>
            </div>
            <div class="grey_header">            
			</div>
        </div>
        <div id="boxWrapper">
            <div id="box">
                <div id="ErrorMessage">
					<div id="errorTitle">
						<h1 id="title"></h1>			
					</div>
					<div id="errorSummary">
						<span id="summary"></span>						
					</div>
					<div id="errorOfflineTitle">
						<h2 id="offlinetitle"></h2>			
					</div>
					<div id="errorSuggestions">
						<span id="suggestions"></span>						
					</div>					
					<div id="errorDetails">
						<span id="details"></span>
					</div>
                </div>				                 
                <div class="reload_btn" id="btnDiv">
                    <div class="uiButton">
                        <a href="#" id="uiButtonReload"></a>
                    </div>
                    <div style="clear: both">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="footer">
		<div id="footer_text">
        &nbsp;&nbsp; © Copyright 2012 Autodesk Inc. All rights reserved. Privacy Policy
        - Legal Notice &amp; Trademarks
		</div>
    </div>
</body>
</html>
